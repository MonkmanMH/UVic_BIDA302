# (PART) Week 2 {-} 


<!-- This file by Martin Monkman is licensed under a Creative Commons Attribution 4.0 International License https://creativecommons.org/licenses/by/4.0/   -->



```{r echo = FALSE}
library(knitr)
opts_chunk$set(message = FALSE, warning = FALSE, cache = TRUE)
options(width = 100, dplyr.width = 100)

library(tidyverse)
```




# Tidy data {#tidy_data}


### Reading

* [_R for Data Science_, Tidy Data chapter](https://r4ds.had.co.nz/tidy-data.html)

* Karl Broman & Kara Woo, ["Data Organization in Spreadsheets"](https://www.tandfonline.com/doi/full/10.1080/00031305.2017.1375989)[@Broman_Woo_2017]

* [{tidyr} reference at tidyverse.org](https://tidyr.tidyverse.org/)




### Readings from _R4DS_

Garrett Grolemund and Hadley Wickham, [R for Data Science](https://r4ds.had.co.nz/)

* [4. Workflow: basics](https://r4ds.had.co.nz/workflow-basics.html)

* [5. Data Transformation](https://r4ds.had.co.nz/transform.html)

* [6. Workflow: scripts](https://r4ds.had.co.nz/workflow-scripts.html)

* [27. R Markdown](https://r4ds.had.co.nz/r-markdown.html)

* [12. Tidy data](https://r4ds.had.co.nz/tidy-data.html), sections 12.1 to 12.3




#### Tidy data

More about tidy data:

["Tidy Data for Efficiency, Reproducibility, and Collaboration"](https://www.openscapes.org/blog/2020/10/12/tidy-data/))



[Reshaping Your Data with tidyr](https://uc-r.github.io/tidyr), UC Business Analytics R Programming Guide

* this article uses the old {tidyr} `gather()` and `spread()` functions instead of `pivot_longer()` and `pivot_wider()`, but it's got some good material on how to think about how and why data needs to be reshaped.



Julia Lowndes and Allison Horst, [Tidy data for efficiency, reproducibility, and collaboration](https://www.openscapes.org/blog/2020/10/12/tidy-data/)

* in google slide version: ["Make friends with tidy data"](https://docs.google.com/presentation/d/1N7hKepabvl9OrHjvGJWPjUsfzVdB5xzV5AsFndgSwms/edit#slide=id.p)

Hadley Wickham. ["Tidy data"](https://vita.had.co.nz/papers/tidy-data.html), _The Journal of Statistical Software_, vol. 59, 2014.

Karl Broman and Kara Woo, ["Data organization in spreadsheets"](https://doi.org/10.1080/00031305.2017.1375989), _The American Statistician_ 72 (1): 2–10.

[Data Organization in Spreadsheets for Social Scientists: Formatting problems](https://datacarpentry.org/spreadsheets-socialsci/02-common-mistakes/index.html) -- DataCarpentry lesson

[Data organization with spreadsheets](https://remi-daigle.github.io/2017-CHONe-Data/organization.nb.html) -- from Data Management Workshop à la CHONe



## Part 2 - `{tidyr}` -


![tidyr hex](static/tidyverse_400.png/tidyr_400.png)

The [{tidyr} site](https://tidyr.tidyverse.org/)



Slide deck:

Julie Lowndes & Allison Horst, [Make friends with tidy data](https://docs.google.com/presentation/d/1N7hKepabvl9OrHjvGJWPjUsfzVdB5xzV5AsFndgSwms/edit#slide=id.p)




A pivot table crosstab using the {mpg} data package of automobile fuel economy.

First, a look at the source table.





Using `group_by` and `summarise` to create a summary table of the average engine displacement:

```{r}
mpg %>%                                
  group_by(class) %>%                   
  summarise(displ_mean = mean(displ)) 

```



Now do the same with vehicle class and number of cylinders:

```{r}

class_by_cyl <- mpg %>%
  group_by(class, cyl) %>%
  summarise(mean = mean(displ)) %>%
  arrange(desc(mean))

class_by_cyl

```




What happens if you reverse the order of the grouping variables?



Create a pivot (crosstab) table with class by number of cylinders:


using `pivot_wider()`

```{r}
class_by_cyl_pivot <- class_by_cyl %>%
  pivot_wider(names_from = cyl, values_from = mean)


class_by_cyl_pivot
```



### and back to longer...

```{r}

class_by_cyl_pivot %>%
  pivot_longer(-class, names_to = "cyl", values_to = "mean")

```




Note that `pivot_wider()` and `pivot_longer()` are new functions, introduced in 2019.

The older {tidyr} functions that do the same thing: `spread()` and `gather()`.

For example, `spread()` to replicate the `pivot_wider()` function:

```{r}

class_by_cyl %>%
  spread(cyl, value = mean)

```



---
title: "Transform Data 3: pivot to reshape"
output: html_notebook
---

<!-- This file by Martin Monkman is licensed under a Creative Commons Attribution 4.0 International License -->


```{r setup}
library(tidyverse)
# data packages
library(gapminder)

```


## Your Turn 3.1

A pivot table crosstab using the {mpg} data package of automobile fuel economy.

First, a look at the source table.

```{r}
mpg
```

Using `group_by` and `summarise` to create a summary table of the average engine displacement by vehicle class:

```{r}
mpg %>%                                
  group_by(class) %>%                   
  summarise(displ_mean = mean(displ)) 

```

Now do the same with vehicle class and number of cylinders:

```{r}
class_by_cyl <- mpg %>%
  group_by(class, cyl) %>%
  summarise(displ_mean = mean(displ)) 

class_by_cyl

```


What happens if you reverse the order of the grouping variables?



Create a pivot (crosstab) table with class by number of cylinders:


```{r}

# pivot table (wide)

class_by_cyl_pivot <- class_by_cyl %>%
  pivot_wider(names_from = cyl, values_from = displ_mean)

class_by_cyl_pivot


```

Now, unpivot it back to the original structure:

```{r}
# and back to longer...

displ_class_by_cyl <- class_by_cyl_pivot %>%
  pivot_longer(-class, names_to = "cyl", values_to = "displ_mean")

displ_class_by_cyl

```

What do you notice about the structure of the unpivoted table?



## Your Turn 3.2

Making some summary tables with the {gapminder} data.

Create a table where:

* object name `lifeExp_by_continent` that has 
* the median life expectency for each continent for every year in the dataframe, 
* where the continent is the column and the year is the row.

(This is a restructuring of the table from 2.4)

```{r}


```

## Your Turn 3.3

Create a table that shows:

* GDP per capita for
* the countries Canada, United States, and Mexico are the columns, and 
* the years after 1980 are the rows

```{r}



```




***

## Take aways

* Restructure data tabulations with `pivot_wider()` and `pivot_longer`  



More about tidy data:

* ["Tidy Data for Efficiency, Reproducibility, and Collaboration"](https://www.openscapes.org/blog/2020/10/12/tidy-data/))




***

## Exercise

[Transform data](https://monkmanmh.shinyapps.io/BIDA302_1-2_transform_data/#section-transform-data-1a-manipulate-cases)

* This exercise gives you an opportunity to practice your {dplyr} and {tidyr} skills



