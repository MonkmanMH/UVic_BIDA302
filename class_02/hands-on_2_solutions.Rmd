---
title: "Variable types"
subtitle: "hands-on examples, with answers"
output: html_notebook
---

<!-- This file by Charlotte Wickham (with some modifications by Martin Monkman) is licensed under a Creative Commons Attribution 4.0 International License, adapted from the orignal work at https://github.com/rstudio/master-the-tidyverse by RStudio and https://github.com/cwickham/data-science-in-tidyverse-solutions. -->

```{r setup}
library(tidyverse)
library(gapminder)

```

# 1. Missing Values


## a short example

`is.na` function is a logical


```{r}
x <- c(1, NA, 3)

is.na(x)

```

## Your Turn 1.1: 

What does `is.na(x)` return?

```{r}
# example
x <- c(1, NA, 3)

# answer
is.na(x)

# There are three values in `x`, and only the second one is `NA`

```


Use `na.rm` within the `sum()` function to calculate the sum of `x`

```{r}
# example
sum(x)

# answer
sum(x, na.rm = TRUE)


```


## Your Turn 1.2: 

Run to create the `displ_class_by_cyl` table:

```{r}
# summary table - class by cylinder
displ_class_by_cyl <- mpg %>%
  group_by(class, cyl) %>%
  summarise(displ_mean = mean(displ)) %>%
  arrange(desc(displ_mean)) %>%
  pivot_wider(names_from = cyl, values_from = displ_mean) %>%
  pivot_longer(-class, names_to = "cyl", values_to = "displ_mean")

displ_class_by_cyl

```

Calculate the mean of `displ_mean`:

```{r}
# example
mean(displ_class_by_cyl$displ_mean)

# solution
mean(displ_class_by_cyl$displ_mean, na.rm = TRUE)

```


An alternative solution: use a filter with `!na` to remove the records with `NA` values:

```{r}
# example
displ_class_by_cyl %>%
  summarise(displ_mean_all = mean(displ_mean))

# solution
displ_class_by_cyl %>%
  filter(!is.na(displ_mean)) %>%
  summarise(displ_mean_all = mean(displ_mean))

```


## Take aways

* using functions to identify unknown values in a variable
* removing and finding


# Summarize with `group()` and `ungroup()`


You'll notice in #1.2 that when we summarize `displ_class_by_cyl` it gives the mean values by class, even though we didn't use any grouping variable.

This is because when we ran the code to create the `displ_class_by_cyl` table, we grouped by `class` and `cyl`. Running the `summarise()` function is applied, it removes one level of the grouping (in this case, `cyl`): 

```{r}

# example
displ_class_by_cyl

displ_class_by_cyl %>%
  filter(!is.na(displ_mean)) %>%
  summarise(displ_mean_all = mean(displ_mean))


```


If you want the mean of all the values, you have to use `ungroup()` before `summarise()`, to "peel off" `class`


```{r}

# solution
displ_class_by_cyl %>%
  filter(!is.na(displ_mean)) %>%
  ungroup() %>%
  summarise(displ_mean_all = mean(displ_mean))


```


