---
title: "Data wrangling"
subtitle: "Part 1: {dplyr}"
author: "BIDA302"
date: "2019/11/02"
output:
  xaringan::moon_reader:
    css: ["default", "css_files/eigengrau.css", "css_files/eigengrau-fonts.css"]    
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false

# Martin Monkman
---


```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

class: inverse

# Data wrangling

Cleaning

Reshaping

Filtering

Adding variables

---


# {dplyr}

![dplyr hex](../img/dplyr_400.png)

The [{dplyr} site](https://dplyr.tidyverse.org/index.html)


---


# the functions are verbs

The ones we'll be discovering today:

|function |action |
| :--- | ---: |
| filter()    | *keep rows*|
| mutate()    | *create a new variable*|
| group_by()  | *declare subsets in data*|
| select()    | *keep variables (or drop them -var)*|
| rename()    | *renaming variables*|
| summarize() | *summarize the data, by groups if they have been declared*|
| tally()     | *counting (by groups if group_by() applied)*|
| distinct()  | *returns only rows that are unique*| 
| case_when() | *is used for "recoding" variable, often used with mutate()*|


???

Source: Gina Reynolds,[Tidyverse in Action](https://github.com/EvaMaeRey/tidyverse_in_action)

* with modifications by Martin Monkman

---

## Arithmetic operators

| Operator | Description |
| : ----- | ---: |
| + | *plus* |
| - | *minus* |
| \* | *multiplication*  |
| / | *division* |
| ^ | *exponential* |

???

Source: Gina Reynolds,[Tidyverse in Action](https://github.com/EvaMaeRey/tidyverse_in_action)


---

## Boolean operators

Boolean operators are a special type of operator that return TRUE or FALSE.  

| Operator | Description |
| : ----- | ---: |
| == | *equal, tests equality* |
| != | *not equal, tests inequality* |
| \> | *greater than, tests greater than* (also >=) |
| < | *less than, tests less than* (also <=) |
| %in% | *contains, tests inclusion* |


Boolean operators can be combined with *and* or *or*.  

| Operator | Description |
| : ----- | ---: |
| & | *and, returns true if preceeding and following are both true, else false* |
| &#124;  | *or, returns true if either preceeding and following are true, else false* |


???

Source: Gina Reynolds,[Tidyverse in Action](https://github.com/EvaMaeRey/tidyverse_in_action)

---



```{r}
mpg %>%
  summarise(minYear = min(year), maxYear = max(year))

```


---

# a summary table

```{r}
mpg %>%                                 ## take my data, then (%>%)
  group_by(class) %>%                   ## group data by variable "class", then
  summarise(mean = mean(displ)) %>%     ## calculate mean of variable "displ" for each, then
  arrange(desc(mean))                   ## sort descending by that mean (ascending is simply "arrange(mean)")
```



---

dplyr::mutate

You can create variables that may (or may not) be useful in your analysis


```{r}

mpg <- mpg %>%
  mutate(mpg_per_cubic_litre = hwy / displ)

summary(mpg$mpg_per_cubic_litre)
```




---

# {tidyr}

![tidyr hex](../img/tidyr_400.png)

The [{tidyr} site](https://tidyr.tidyverse.org/)


---

A pivot table crosstab (1/2)
Note that spread() (and gather(), it's complement) are from tidyr

```{r}

class_by_cyl <- mpg %>%
  group_by(class, cyl) %>%
  summarise(mean = mean(displ)) %>%
  arrange(desc(mean))

class_by_cyl

```


---

A pivot table crosstab (2/2)


```{r}
class_by_cyl_pivot <- class_by_cyl %>%
  spread(cyl, value = mean, drop = FALSE)

class_by_cyl_pivot <- as.data.frame(class_by_cyl_pivot)

class_by_cyl_pivot
```



