---
title: "Gapminder - ageing Europe recreation"
output: html_notebook
---

This is the preliminary step to recreate the chart Hans Rosling shows in the video here:

* Presentation Zen, [Hans Rosling: the zen master of presenting data](https://www.presentationzen.com/presentationzen/2010/07/hans-rosling-tips-on-presenting-data.html), 2010-07-11

```{r setup}
library(tidyverse)
library(readxl)
```

At the end of this section, you will have plotted some gapminder data to produce an approximation of this chart:

![Hans Rosling, aging Europe 1961](../img/Hans_Rosling_aging_europe.JPG)

Or, more precisely:
Because the population aged 60+ data is published for every fifth year, there will be two charts: one for 1960, the other for 2015.

```{r}

```

I downloaded the data tables from https://www.gapminder.org/data/, for 

* Population, total

* Population, aged 60+

* Babies per woman (total fertility)


### Load and select

```{r}

pop_total <- read_csv("population_total.csv")

pop_60plus <- read_csv("population_aged_60plus_years_total_number.csv")

children_per_woman <- read_csv("children_per_woman_total_fertility.csv")

```


```{r}

pop_total

```


```{r}

pop_total %>%
  select(country, "1960", "2015")

pop_total_6015 <- pop_total %>%
  select(country, "1960", "2015") %>%
  pivot_longer(-country, names_to = "year", values_to = "population")

pop_total_6015

```



```{r}

pop_60plus %>%
  select(country, "1960", "2015")

pop_60plus_6015 <- pop_60plus %>%
  select(country, "1960", "2015") %>%
  pivot_longer(-country, names_to = "year", values_to = "pop_60plus")

pop_60plus_6015


```

```{r}

children_per_woman %>%
  select(country, "1960", "2015")

children_per_woman_6015 <- children_per_woman %>%
  select(country, "1960", "2015") %>%
  pivot_longer(-country, names_to = "year", values_to = "fert_rate")

children_per_woman_6015

```


Read country geography table

```{r}

data_geographies <- read_excel("Data Geographies - v1 - by Gapminder.xlsx", sheet = "list-of-countries-etc")

data_geographies_select <- data_geographies %>%
  select(geo, name, four_regions)

data_geographies_select

```


### join the four tables

```{r}

df_gapmind <-
pop_total_6015 %>%
  inner_join(pop_60plus_6015, by = c("country", "year")) %>% 
  inner_join(children_per_woman_6015, by = c("country", "year")) %>% 
  mutate(pct_60plus = round((pop_60plus / population * 100), 2)) 
  
df_gapmind <-
df_gapmind %>% 
  inner_join(data_geographies_select, by = c("country" = "name"))

df_gapmind
```


## Plot

```{r}

df_gapmind %>%
  filter(year == 1960) %>%
# plot
ggplot() +
  geom_point(mapping = aes(x = fert_rate, y = pct_60plus))


```


```{r}

plotyear <- 1960

df_gapmind %>%
  filter(year == plotyear) %>%
# plot
ggplot() +
  geom_point(mapping = aes(x = fert_rate, y = pct_60plus, color = four_regions))
  
```



```{r}

# add balloon plotting for population size

plotyear <- 1960

df_gapmind %>%
  filter(year == plotyear) %>%
# plot
ggplot() +
  geom_point(mapping = aes(x = fert_rate, y = pct_60plus, color = four_regions, size = population)) +
  scale_size_area(max_size = 15)
  
```
