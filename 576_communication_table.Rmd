<!-- 
This file by Martin Monkman 
is licensed under a Creative Commons Attribution 4.0 International License
https://creativecommons.org/licenses/by/4.0/  
-->

# Communicationâ€”table formatting {#communicationtable}

## Setup

This chunk of R code loads the packages that we will be using.

```{r setup_576, eval=FALSE}
library(tidyverse)
```





## Introduction {#communication-table-intro}

The look of the default table in R markdown is not all that attractive. Here's a summary table of the Oakland Athletics' seasons from 1999-2008.

```{r moneyball_oakland}

oakland_99 <- mlb_pay_wl |> 
  filter(tm == "OAK" & year_num < 2009)

oakland_99
```

There are a few R packages that allow us to format a table like this, ready for publication. Here we will take a quick look at two of them. Both have many, many more options for formatting; see the reference materials at the top of this chapter for those details.


## The kable package {#communication-table-kable}


First, {kableExtra} is an extension to the {kable} tool that is part of "knitting" our R Markdown files.

```{r}
library(kableExtra)

# print table with {kableExtra} formatting  
oakland_99 |>
  # create table, add title
  kable(caption = "Oakland Athletics, 1999-2008") |>
  kable_styling(bootstrap_options = "striped", font_size = 10) |>
  # make variable names bold and large
  row_spec(0, bold = T, font_size = 14) |>
  # make 2002 season (row 4) bold
  row_spec(4, bold = T) 
```  



## The flextable package {#communication-table-flextable}


Another table formatting package is {flextable}. 

In this first code chunk, we create use `flextable()` to turn our dataframe into a flextable object, and add a "Source" annotation as a footer to our table.

```{r}
library(flextable)

oakland_99 |> 
  flextable() |> 
  add_footer_row(values = "Source: baseball-reference.com", colwidths = 8)

```

You'll notice that the year has a comma separating the thousands. This is because the "year" variable is numeric. In the chunk below, this is dealt with by using the `as.character()`, _before_ the `flextable()` function is applied.

The code then adds a variety of formatting.

Note that the functions are format-first. For example, font size is the function `fontsize()` and which row is an argument. This is opposite to what we see with {kableExtra}, where the row or column is specified with `row_spec()`, and then the formatting applied. 

It's also possible to make formatting conditional on values in the table. In this code, the background colour is set using the `bg()` function, but only for those cases where wins (the "w" variable) is 100 or higher.

```{r}
## print table with {flextable} formatting  
oakland_99 |> 
  mutate(year_num = as.character(year_num)) |>
  ## create table
  flextable() |> 
  ## add row striping
  theme_zebra() |>
  ## set font size to 10
  fontsize(size = 10, part = "all") |>
  ## but set variable names larger
  fontsize(size = 14, part = "header") |>
  ## make variable names bold
  bold(part = "header") |>
  ## make 2002 season (row 4) bold
  # bold(i = 4) |>
  ## or with conditional specification: where year_num is 2002
  bold(~ `year_num` == 2002) |>
  ## conditional background color as gold where wins are greater than 100
  bg(~ w >= 100, bg = "gold") |>
  ## set nicer column labels
  set_header_labels(year_num = "Year", tm = "Team", attend_g = "Attendance", 
                    est_payroll = "Payroll ($)", pay_index = "Pay Index",
                    w = "Wins", l = "Losses", w_l_percent = "Win-Loss Percentage") |>
  ## add footer
  add_footer_row(values = "Source: baseball-reference.com", colwidths = 8)

```

## Another example

Earlier in this course, covered in the chapter An example of a data analytics project, we saw some other examples of data tables that were made publication-ready through {kableExtra} and {flextable} formatting. You are encouraged to review that code to see some other options that these packages make available.



## Reading & reference  {#communication-table-reading}

**R Markdown**

Yihui Xie, Christophe Dervieux, Emily Riederer, ["The kableExtra package", _R Markdown Cookbook_](https://bookdown.org/yihui/rmarkdown-cookbook/kableextra.html)



Packages:

**kableExtra**

* Hao Zhu, [Create Awesome HTML Table with knitr::kable and kableExtra](https://haozhu233.github.io/kableExtra/awesome_table_in_html.html)

* Hao Zhu, [Using kableExtra in Bookdown](https://haozhu233.github.io/kableExtra/bookdown/index.html)

* Yihui Xie, Christophe Dervieux, Emily Riederer, ["The kableExtra package", _R Markdown Cookbook_](https://bookdown.org/yihui/rmarkdown-cookbook/kableextra.html)

* [KableExtra Tutorial](https://rstudio-pubs-static.s3.amazonaws.com/444395_76727eaf9c774fa8bf932bed16500a00.html)




**gt**

* [{gt} package site](https://gt.rstudio.com/index.html)

* [Introduction to Creating gt Tables](https://gt.rstudio.com/articles/intro-creating-gt-tables.html) (from the package site)



-30-
