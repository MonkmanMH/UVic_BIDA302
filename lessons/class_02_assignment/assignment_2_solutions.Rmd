---
title: "BIDA302 - assignment #2"
subtitle: "solutions"
  html_document:
    df_print: paged
---

## YOUR NAME HERE


Package load:
```{r setup}
library(tidyverse) # functions using {tidyr}, {dplyr}, and {readr}
library(readxl)    # to read Excel files
```


## Introduction

> For this homework assignment, please write your answer for each question after the question text but before the line break before the next one.

> In some cases, you will have to insert R code chunks, and run them to ensure that you've got the right result.

> Use all of the R Markdown formatting you want! Bullets, bold text, etc. is welcome.

> Once you have finished your assignment, create an HTML document by "knitting" the document using either the "Preview" or "Knit" button in the top left of the script window frame


## Questions


### 1. Religion and income data (USA)
> (2 marks)

> The table `relig_income` is in {tidyr}.
>
>a. Load this table, and take a look at it. What tidy principle(s) does this table violate? (See the ["Tidy Data" chapter](https://r4ds.had.co.nz/tidy-data.html) in _R4DS_., and ["Tidy Data for Efficiency, Reproducibility, and Collaboration"](https://www.openscapes.org/blog/2020/10/12/tidy-data/))
>

```{r}
tidyr::relig_income
```
It violates Principle #1, each variable must have its own column. In this example, the "income" variable is spread across 10 columns.


>
>b. Using the functions in {tidyr}, arrange this table in such a way that it is no longer untidy.


```{r}

relig_income_long <- relig_income %>%
  pivot_longer(-religion, names_to = "income_cat", values_to = "count")

relig_income_long
```

And to pivot it back to wide layout:


```{r}

relig_income_long %>%
  pivot_wider(names_from = "income_cat", values_from = "count")

```


***



### 2. Importing data: csv
> (5 marks)
>
> **NOTE:**
> Variable names with spaces and special symbols are a challenge to work with. They require
> that you put the name inside a pair of back-ticks. For example, in the dataset below, a variable called `Court Region` _must_ be inside the back-ticks. 
>
> Comma delimited files are one of the most common formats used for flat files. The tidyverse has a package, {readr}, which will automatically load with the function `library(tidyverse)`.
>
> The reference page for {readr} is here: https://readr.tidyverse.org/index.html
>
>
> a. Read in the file "cy-concluded-cases-5-yr-regional-report-dashboard-2014-to-2018.csv", which has the number of concluded court cases in B.C. by a variety of dimensions.
>
> b. Assign the contents of the file to a named object (remember, name things in a descriptive way!)
> 


**Answer:**

```{r}
# solution
court_cases <- read_csv("cy-concluded-cases-5-yr-regional-report-dashboard-2014-to-2018.csv")
```

> b. Read the file again, but specify that the region code should be a character.

```{r}
# solution
court_cases <-
  read_csv(
    "cy-concluded-cases-5-yr-regional-report-dashboard-2014-to-2018.csv",
    col_types = cols('Court Region Code' = col_character())
  )

# if we wanted to also specify that "Year" be in date format:
#court_cases <-
#  read_csv("cy-concluded-cases-5-yr-regional-report-dashboard-2014-to-2018.csv",
#                        col_types = cols(
#                          `Court Region Code` = col_character(),
#                           Year = col_date(format = "%Y")
#                        ))

```


>c. Now you've read it in, use your data manipulation skills to find out how many cases were completed in each court region in 2018. Sort the table so the busiest regions are at the top.

<ctrl><shift>a

```{r}
# solution
court_cases %>%  
  filter(Year == 2018) %>%
  group_by(`Court Region Code`) %>% 
  summarise(total_cases = sum(Count)) %>% 
  arrange(desc(total_cases))

```

> d. Create a pivot table showing the total number of cases completed in each region during 2018, with the region as the rows and the court class as the columns. 

```{r}
# solution
court_cases %>%
  filter(Year == 2018) %>%
  group_by(`Court Region`, `Court Class`) %>%
  summarise(total_cases = sum(Count)) %>%
  pivot_wider(names_from = `Court Class`, values_from = total_cases)
```


```{r}
read_csv("cy-concluded-cases-5-yr-regional-report-dashboard-2014-to-2018.csv",
        col_type = cols(`Court Region` = col_character())) %>%

 filter(Year == 2018) %>%
  arrange(desc(Count)) %>%
 
  pivot_wider(names_from = `Court Region`, values_from = Count) %>%
  pivot_longer(c(Fraser, `Vancouver Coastal`, `Vancouver Island`, Interior, North),
               names_to = "Court Region", values_to = "Count")
```


### 3. Importing data: Excel
> (5 marks)
>
> Use the {readxl} package to read in the file "regional_district_monthly_2019_mod.xlsx" 
>
> This data is published by the Ministry of Finance, and shows a variety of statistics associated with the Property Transfer Tax.
>
> The original file has been modified:
> 
> * filter for the Capital Regional District (CRD) and
>
> * the resulting table is transposed, so the rows now become the columns.
>
> The website source for the data is here: https://catalogue.data.gov.bc.ca/dataset/property-transfer-tax-data-2019
>
> The reference page for {readxl} is here: https://readxl.tidyverse.org/
>
>
>a. What are the names of the sheets in this file?

```{r}
# solution

excel_sheets("regional_district_monthly_2019_mod.xlsx")

```

> b. Read in the contents of the sheet with the shortest name.

```{r}

read_excel("regional_district_monthly_2019_mod.xlsx", sheet = "CRD_MONTHLY_2019")

```

* c. What issues are there with the rows? What is the header row, and in what row does the data begin? How does this structure impact how the values in the columns are being represented? 

d. Change the options for your read function to address the issues you identified in 3.c

```{r}
# solution

crd <- read_excel("regional_district_monthly_2019_mod.xlsx", sheet = "CRD_MONTHLY_2019", 
           skip = 2)
crd
```

> 
> e. Use your data manipulation skills to calculate the number of residential property transfers where there was foreign involvement. (There are many variables; the one you're looking for is `FOREIGN INVOLVEMENT TRANSACTIONS - RESIDENTIAL (count)`)
> 
> **Note:** Depending on what you did in 3.d, you may need to go back and read the data in again, adding more options.


```{r}
# solution

read_excel("regional_district_monthly_2019_mod.xlsx", sheet = "CRD_MONTHLY_2019", 
           skip = 2,
           na = "nr") %>% 
  summarise(foreign_inv_res = sum(`FOREIGN INVOLVEMENT TRANSACTIONS - RESIDENTIAL (count)`, na.rm = TRUE))

# filter out the rows with NA values in the variable we're interested in
read_excel("regional_district_monthly_2019_mod.xlsx", sheet = "CRD_MONTHLY_2019", 
           skip = 2, na = "nr") %>% 
  filter(!is.na(`FOREIGN INVOLVEMENT TRANSACTIONS - RESIDENTIAL (count)`)) %>% 
  select(Statistics, `FOREIGN INVOLVEMENT TRANSACTIONS - RESIDENTIAL (count)`) %>% 
  summarise(foreign_inv_res = sum(`FOREIGN INVOLVEMENT TRANSACTIONS - RESIDENTIAL (count)`))



```

